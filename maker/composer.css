/* --- Global Styles & Variables --- */
:root {
    --color-bg-main: #282c34;
    --color-bg-light: #3a4049;
    --color-bg-lighter: #4a515c;
    --color-text-main: #abb2bf;
    --color-text-bright: #e6e6e6;
    --color-border: #4a515c;
    --color-primary: #61afef;
    --color-accent: #c678dd;
    --piano-key-height: 20px;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: var(--color-bg-main);
    color: var(--color-text-main);
    overflow: hidden;
}

/* --- Layout Sections --- */
.composer-container {
    display: flex;
    flex-grow: 1;
}
.main-content {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

/* --- Header / Global Controls --- */
.global-controls {
    padding: 8px 15px;
    background-color: var(--color-bg-light);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    gap: 15px;
    flex-shrink: 0;
}
.global-controls label { font-size: 0.9em; font-weight: 500; }
.global-controls input {
    padding: 6px 8px;
    border-radius: 4px;
    border: 1px solid var(--color-border);
    background: var(--color-bg-main);
    color: var(--color-text-bright);
    width: 120px;
}
.global-controls input[type="number"] { width: 60px; }
.global-controls button {
    padding: 6px 14px;
    border-radius: 4px;
    border: none;
    background-color: var(--color-primary);
    color: var(--color-bg-main);
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
}
.global-controls button:hover { background-color: #82c4ff; }
.global-controls button#stop-btn { background-color: #e06c75; }
.global-controls button#stop-btn:hover { background-color: #ff8c95; }

/* --- Tool Palette --- */
.tool-palette {
    width: 200px;
    padding: 15px;
    background-color: var(--color-bg-light);
    border-right: 1px solid var(--color-border);
    overflow-y: auto;
    flex-shrink: 0;
}
.tool-group { margin-bottom: 25px; }
.tool-group h3 {
    margin-top: 0;
    margin-bottom: 12px;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 8px;
    font-size: 1em;
    color: var(--color-text-bright);
}
.tool-group label {
    display: block;
    margin-bottom: 8px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s;
}
.tool-group label:hover { background-color: var(--color-bg-lighter); }
.tool-group input[type="radio"] { margin-right: 8px; }
.tool-group input[type="range"] { width: 100%; margin-top: 5px; }
.tool-group span { font-size: 0.9em; color: var(--color-primary); }

/* --- Piano Roll Section --- */
.piano-roll-wrapper {
    flex-grow: 1;
    display: flex;
    overflow: hidden;
}
#piano-keys {
    width: 120px;
    background-color: var(--color-bg-light);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
}
.piano-key {
    height: var(--piano-key-height);
    box-sizing: border-box;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
    position: relative;
}
.piano-key.white { background-color: #ddd; color: #333; }
.piano-key.black { background-color: #333; color: #eee; border-bottom: 1px solid #555;}
.piano-key.c-key::before {
    content: attr(data-octave);
    position: absolute;
    left: 5px;
    font-size: 0.8em;
    color: var(--color-accent);
}

.piano-roll-container {
    flex-grow: 1;
    overflow: auto;
    background-color: var(--color-bg-main);
    position: relative;
}

#piano-roll-grid {
    position: absolute;
    top: 0; left: 0;
    /* Background gradients for grid lines */
    background-size: 100% calc(var(--piano-key-height) * 12);
    background-image:
        /* Horizontal lines for each key */
        linear-gradient(to bottom, var(--color-bg-light) 1px, transparent 1px),
        /* Horizontal lines for black keys (darker rows) */
        repeating-linear-gradient(to bottom,
            transparent 0,
            transparent var(--piano-key-height),
            var(--color-bg-lighter) var(--piano-key-height),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 2),
            transparent calc(var(--piano-key-height) * 2),
            transparent calc(var(--piano-key-height) * 3),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 3),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 4),
            transparent calc(var(--piano-key-height) * 4),
            transparent calc(var(--piano-key-height) * 5),
            transparent calc(var(--piano-key-height) * 6),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 6),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 7),
            transparent calc(var(--piano-key-height) * 7),
            transparent calc(var(--piano-key-height) * 8),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 8),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 9),
            transparent calc(var(--piano-key-height) * 9),
            transparent calc(var(--piano-key-height) * 10),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 10),
            var(--color-bg-lighter) calc(var(--piano-key-height) * 11)
        );
}

.note-block {
    position: absolute;
    box-sizing: border-box;
    cursor: move;
    border-radius: 4px;
    height: calc(var(--piano-key-height) - 2px);
    margin-top: 1px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.7);
    overflow: hidden;
    transition: box-shadow 0.2s;
}
.note-block:hover {
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    z-index: 10;
}
.note-block.selected {
    border: 2px solid var(--color-accent);
}

/* Color coding for waveforms */
.note-type-0 { background-color: #61afef; } /* Sine */
.note-type-1 { background-color: #98c379; } /* Triangle */
.note-type-2 { background-color: #e06c75; } /* Square */
.note-type-3 { background-color: #c678dd; } /* Sawtooth */
.note-type-4 { background-color: #abb2bf; color: #282c34;} /* Noise */

/* --- Mimi Code Output Area --- */
.mimi-code-area {
    height: 200px;
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--color-border);
    flex-shrink: 0;
}
.code-header {
    padding: 5px 15px;
    background-color: var(--color-bg-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
}
.code-header button {
    padding: 4px 10px;
    border-radius: 4px;
    border: none;
    background-color: var(--color-accent);
    color: white;
    cursor: pointer;
    transition: background-color 0.2s;
}
.code-header button:hover { background-color: #e098f9; }

#mimi-output {
    flex-grow: 1;
    width: 100%;
    box-sizing: border-box;
    border: none;
    padding: 10px;
    font-family: "Fira Code", "Courier New", monospace;
    font-size: 14px;
    resize: none;
    background-color: var(--color-bg-main);
    color: var(--color-text-main);
}